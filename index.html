<!doctype html>
<html>
<head>
    <script src="http://code.jquery.com/jquery-1.6.1.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="microphone.js"></script>
</head>
<body>
<script>

    var socket = io.connect();
    socket.on('podcast', function(from, msg) {
        //$('#lines').append($('<p>').append($('<b>').text(from), msg));
        console.log("from", from, "msg", msg)
    });
    
    var mic = new Microphone(  { 
        mode       : 2, //Available modes: Recording -> 1, Streaming -> 2
        sampleRate : 8000,
        gain       : 90,
        swfPath    : 'microphone.swf',
        debugging  : true},
        
        function(){//this function is called when user allow us to access microphone.
        
        mic.swf.rate = 8;
        //mic.sampleRate = 8000;
        //sample handler
        mic.onSamplesAvailable = function(data,channelCount){
            //console.log(data);
            socket.emit('user message', data);
        };
        
        //set sample rate
        //mic.sampleRate = 44100;
        //get list of microphones available
        console.log(mic.getMicrophoneList());
        //get sample rate
        console.log(mic.sampleRate);
        //get microphone name in use
        console.log(mic.name);
        
        //starts streaming
        mic.start();
        
        //stops streaming after 1 second
        /*setTimeout(function(){
            mic.stop();
        },2000);
        */
    });
</script>
</body>
</html>
