<!doctype html>
<html>
<head>
    <script src="http://code.jquery.com/jquery-1.6.1.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="microphone.js"></script>
</head>
<body>
    <button value="Record">Record</button>
    <button value="Stop">Stop</button>
    
    <div id="file">
        
    </div>
    
    <audio id="radio"></audio>
    
<script>
    var socket = io.connect();
    var mic;
    $("button[value='Record']").click(function() {
        var name = "id_" + new Date().getTime();
        socket.emit("start", name);
        var $file = $("#file");
        $file.append("<br/>");
        var link = $("<a>");
        link.attr("src", "#"+name)
            .click(function() {
                socket.emit('listen', name);
            })
            .html(name)
            .appendTo($file);
        mic = new Microphone(function(){
            mic.swf.rate = 8;
            mic.onSamplesAvailable = function(data,channelCount){
                socket.emit('user message', data);
            };
            mic.start();
        });
    });
    
    $("button[value='Stop']").click(function() {
        if(mic) {
            mic.stop();
            socket.emit('stop', "stop");
        }
    });
</script>
</body>
</html>
